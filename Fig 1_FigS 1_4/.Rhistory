xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
w
eig.bottom
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
w
sum(w)
m3 <- born[4] - w[1]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(4:length(w))] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(4:length(w))] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
w
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(4:length(w))] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(4:length(w))] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(4:length(w))] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.1, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.1, 0.2, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.2, 0.2, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.1, 0.1))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.8, 0.8))
m3 <- born[3]
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
{if (eig.bottom)
m3 <- born[3]
else m3 <- born[4] - w[1]
}
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.8, 0.8))
{if (eig.bottom)
m3 <- born[3]
else m3 <- born[4] - w[1]
}
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
born[3]
w
xx
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.8, 0.8))
{if (eig.bottom)
m3 <- born[3]
else m3 <- born[4] - w[1]
}
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
W
W
w
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.8, 0.8))
{if (eig.bottom)
m3 <- born[3]
else m3 <- born[4] - w[1]
}
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
nf <- mcoa1$nf
eig.bottom = TRUE
opar <- par(mar = par("mar"))
on.exit(par(opar))
born <- par("usr")
w <- mcoa1$pseudoeig
col <- rep(grey(1), length(w))
col[1:nf] <- grey(0.8)
col[c(1:2)] <- grey(0)
l0 <- length(w)
xx <- seq(born[1], born[1] + (born[2] - born[1]) * l0/60,
le = l0 + 1)
w <- w/max(w)
w <- w * (born[4] - born[3])/4
par(mar = c(0.8, 0.8, 0.8, 0.8))
{if (eig.bottom)
m3 <- born[3]
else m3 <- born[4] - w[1]
}
w <- m3 + w
rect(xx[1], m3, xx[l0 + 1], w[1], col = grey(1))
for (i in 1:l0) rect(xx[i], m3, xx[i + 1], w[i], col = col[i])
rect(xx[1], m3, xx[1 + 1], w[1], col = col[1])
View(opar)
xx
a <- rect(xx[1], m3, xx[1 + 1], w[1], col = col[1])
pcoa_eig <- (mcoa1$pseudoeig)[1:2] / sum(mcoa1$pseudoeig)
pcoa_eig
pcoa_eig <- (mcoa1$pseudoeig)[1:20] / sum(mcoa1$pseudoeig)
pcoa_eig
barplot(pcoa_eig)
pcoa_eig <- (mcoa1$pseudoeig)[1:16] / sum(mcoa1$pseudoeig)
barplot(pcoa_eig)
library(ade4)
data(friday87)
w1 <- data.frame(scale(friday87$fau, scal = FALSE))
w2 <- ktab.data.frame(w1, friday87$fau.blo, tabnames = friday87$tab.names)
mcoa1 <- mcoa(w2, "lambda1", scan = FALSE)
mcoa1
plot(mcoa1)
setwd("E:/陈沛霖-病原菌/宏转录/MS/code/Fig 1")
library(vegan)
ko <- read.csv("AMS_TPM.csv",header = T,row.names = 1)
ko <- t(ko)
zg <- read.csv("Group_1.csv",header = T,row.names = 1)
zg <- subset(zg, zg$Group_common=="1")
zg <- subset(zg, zg$Compartment =="Root")
zg$Week  <- gsub("TP", "",zg$Week, fixed = TRUE)
zg$Week  <- as.numeric(zg$Week)
ko_c <- as.data.frame(ko[row.names(ko)%in%row.names(zg),])
otu <- read.csv("BacteriaFungi2019.07.10.csv",header = T,row.names = 1)
otu<- data.frame(t(otu))
otu <- as.data.frame(otu[row.names(otu)%in%row.names(zg),])
otu$sum <- rowSums(otu)
otu_c <- subset(otu, sum >= 65)
otu_c <- otu_c[,-c(66)]
otu_c = as.data.frame(rrarefy(otu_c, min(rowSums(otu_c))))
zg <- as.data.frame(zg[row.names(zg)%in%row.names(otu_c),])
ko_c<- as.data.frame(ko_c[row.names(ko_c)%in%row.names(otu_c),])
row.names(ko_c)==row.names(otu_c)
row.names(ko_c)==row.names(zg)
otu <- otu_c
library(vegan)
library(ggplot2)
library(ape)
library(tidyverse)
otu_dist <- vegdist(decostand(otu,"hellinger"),method = 'bray')
a_otu_dist_matrix<-as.matrix(otu_dist)
ko_dist <-  vegdist(decostand(ko_c,"hellinger"),method = 'bray')
a_express_dis_matrix<-as.matrix(ko_dist)
mant <- mantel(a_otu_dist_matrix,a_express_dis_matrix,permutations = 999)
mant_r <- round(mant$statistic,3)
mant_p <- mant$signif
mds.f <- as.data.frame(pcoa(otu_dist)$vectors)
mds.e <- as.data.frame(pcoa(ko_dist)$vectors)
pro <- procrustes(mds.f,mds.e, symmetric = TRUE)
pro_test <- protest(mds.f,mds.e, permutations = 999)
eigen <- sqrt(pro$svd$d)
percent_var <- signif(eigen/sum(eigen), 4)*100
beta_pro <- data.frame(pro$X)
trans_pro <- data.frame(pro$Yrot)
beta_pro$UserName <- rownames(beta_pro)
beta_pro$type <- "OTU"
trans_pro$UserName <- rownames(trans_pro)
trans_pro$type <- "Transcript"
colnames(trans_pro) <- colnames(beta_pro)
pvalue = pro_test$signif
M =round(pro_test$ss,3)
plot <- rbind(beta_pro, trans_pro)
zg$UserName <- row.names(zg)
plot <- left_join(plot,zg,by='UserName')
p1 <- ggplot(plot) +
geom_point(size = 3, aes(x = Axis.1, y = Axis.2, color=Week,shape=type))+labs(title = "Procrustes test: AM fungal transcripts v.s. OTUs") +
scale_shape_manual(values=c(1,19))+scale_color_distiller(palette = "Spectral")+
theme_classic() +
geom_line(aes(x= Axis.1, y=Axis.2, group=UserName), col = "darkgrey", alpha = 0.4)+theme_bw() +
theme(strip.text = element_text(size = 15,face="bold"),
panel.spacing = unit(0, "lines"),
legend.title = element_text(colour="black", size=12, face="bold"),
legend.text = element_text(colour="black", size=10, face="bold"),
axis.text=element_text(size=10,face="bold"),
axis.title=element_text(size=15,face="bold"),title=element_text(size=15,face="bold"),legend.position = "bottom") +
guides(shape=guide_legend(title="Type",byrow = T,nrow = 2,title.position = "top",title.hjust = 0.5),color=guide_colorbar(title="Week",title.position = "top")) +
annotate("text", x = 0.043, y = 0.05, label = paste0("Protest: M2=",M,"  p<",pvalue,"\n","Mantel: R=",mant_r,"  p<",mant_p), size = 4) +
xlab(paste0("PCo1 (",percent_var[1],"%)")) +
ylab(paste0("PCo2 (",percent_var[2],"%)"))
library(ape)
adonis_result_ko_c <- adonis(ko_c~zg$Week*zg$Treat*zg$Cultivar)
adonis_result_ko_c$aov.tab
ko_dismatix <- vegdist(decostand(ko_c,"hellinger"),"bray")
ko.pc <- pcoa(ko_dismatix)
pc1=round(ko.pc$values$Relative_eig[1], 3)*100
pc2=round(ko.pc$values$Relative_eig[2], 3)*100
pc.ko = as.data.frame(ko.pc$vectors)
p2<-ggplot(pc.ko,aes(Axis.1,Axis.2)) +
geom_point(aes(color=zg$Week,shape=zg$Treat),size=3)+labs(title = "PCo analysis of AM fungal transcripts")+
labs(x = sprintf("PCo1 (%.1f%%)", pc1), y = sprintf("PCo2 (%.1f%%)", pc2))+
scale_shape_manual(values=c(15,17,16))+scale_color_distiller(palette = "Spectral")+
guides(shape=guide_legend(title="Treatment",bycol = T,ncol = 3,title.position = "top",title.hjust = 0.5),color=guide_colorbar(title="Week",title.position = "top"))+theme_bw()+
theme(strip.text = element_text(size = 15,face="bold"),
panel.spacing = unit(0, "lines"),
legend.title = element_text(colour="black", size=12, face="bold"),
legend.text = element_text(colour="black", size=10, face="bold"),
axis.text=element_text(size=10,face="bold"),
axis.title=element_text(size=15,face="bold"),title=element_text(size=15,face="bold"),legend.position = "bottom")+
annotate("text", x = 0.2, y = -0.2, label = paste0("Time: R2=0.188, p<0.001","\n","Treatment: R2=0.067, p<0.001","\n","Cultivar: R2=0.066, p<0.001"), size = 4)
library(ggpubr)
ggarrange(p2,p1, common.legend=TRUE,legend = "bottom")
ggsave("Root_PCOA&procrustes3.20221.pdf",width = 12, height =4.5)
FigS2
OTU_dismatix <- vegdist(decostand(otu,"hellinger"),"bray")
ko.pc <- pcoa(OTU_dismatix)
pc1=round(ko.pc$values$Relative_eig[1], 3)*100
pc2=round(ko.pc$values$Relative_eig[2], 3)*100
pc.ko = as.data.frame(ko.pc$vectors)
ggplot(pc.ko,aes(Axis.1,Axis.2)) +
geom_point(aes(colour=zg$Week,shape=zg$Treat),size=3)+labs(title = "PCo analysis of AM fungal OTUs")+
labs(x = sprintf("PCo1 (%.1f%%)", pc1), y = sprintf("PCo2 (%.1f%%)", pc2))+
scale_shape_manual(values=c(15,17,16))+scale_color_distiller(palette = "Spectral")+
guides(shape=guide_legend(title="Treatment",bycol = T,ncol = 3,title.position = "top",title.hjust = 0.5),color=guide_colorbar(title="Week",title.position = "top"))+theme_bw()+
theme(strip.text = element_text(size = 15,face="bold"),
panel.spacing = unit(0, "lines"),
legend.title = element_text(colour="black", size=12, face="bold"),
legend.text = element_text(colour="black", size=10, face="bold"),
axis.text=element_text(size=10,face="bold"),
axis.title=element_text(size=15,face="bold"),title=element_text(size=15,face="bold"),legend.position = "bottom")+
annotate("text", x = 0.28, y = -0.365 , label = paste0("Time: R2=0.473, p<0.001","\n","Treatment: R2=0.074, p<0.001","\n","Cultivar: R2=0.004, p=0.278"), size = 4)
row.names(otu)==row.names(zg)
adonis_result_otu <- adonis(otu~zg$Week*zg$Treat*zg$Cultivar)
adonis_result_otu$aov.tab
ggsave("Pcoa_AMSotu_Root.20221.pdf",width = 9, height =6)
